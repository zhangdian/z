# 2013-06-25-learning-shell

##文本处理工具

###排序工具 __sort__

sort将输入看做有多条_记录_的数据流。
	
* _记录_是由可变宽度的_字段_组成；
* _记录_是以_换行字符_为定界符；
* _字段_的定界符则是_空白字符_或者是用户指定的_单个_字符；

####常用选项

* -b 忽略开头的空白
* -f 忽略大小写
* -i 忽略无法打印的字符
* -k 定义进行排序的键值字段
* -m 将排好序的文件，合并为一个排序后的输出数据流
* -n 以整数类型比较字段
* -o 输出到文件（如果输出文件盒输入文件为同一文件，那么会将它复制到一个临时的文件）
* -r 倒序排序
* -t 指定单个字符，为默认的字段分隔字符，取代默认的空白字符
* -u 如果有_相同键值_的记录，只保留其中的一条

有一点需要注意：对于指定了`-n`选项，那么在收集指定的键值字段的时候，如果遇到非阿拉伯数字，那么就会停止收集，而不会收集到记录的结尾处。比如`-k3nr`，并不会从第三个字段开始，一直收集到记录的结尾处，而是遇到非阿拉伯数字的时候就会截止。

<!-- more -->

####使用示例

	sort -k2       // 排序键值从第二个字段开始，一直到记录的结尾
	sort -k3,4     // 排序键值从第三个字段开始，直到第四个字段结尾处
	sour -k2.3,4.5 // 排序键值从第二个字段的第三个字符开始，直到第四个字段的第五个字符结束

有两点需要注意：

* 如果排序的键值正好的记录的结尾处之后，则排序键值空，并且空的排序键值在排序的时候优先于所有的非空键值；
* 如果出现了多个-k选项，那么会从第一个键值开始排序，找到匹配该键值的记录后，再进行第二个键值字段的排序；

####sort的稳定性

排序的稳定性是指：相同键值的记录在排序之后，是否能够保持相同的顺序。当以多键值为记录进行排序时，或者是以管道处理时，排序稳定性就非常重要了。

而sort排序并不是稳定的。幸好GNU实现了coreutils包，弥补了不足，它可以通过--stable选项补救此问题。

###删除重复记录 __uniq__

在前面讲到的`sort`命令中，可以使用`sort -u`命令来删除重复的记录。__而它是依据匹配的键值来删除记录的，而并不是匹配完整的记录__。

uniq提供另外一种过滤方式，常用语管道中，用来删除已使用`sort`排序之后的，__重复的记录__。

####常用选项

* -c 在每个输出行之前加上该行重复的次数
* -d 仅显示重复的行
* -u 显示未重复的行

####使用示例

	sort ... | uniq | ...

###格式化段落 __fmt__

fmt命令可以将数据流完成重新格式化。

####常用选项

* -s 仅切割较长的行，但是不会将短行结合成较长的行
* -w_n_ 设置输出行宽度为n个字符（默认通常约为75个字符左右）

###计算行数、字数和字符数 __wc__

wc默认输出时一行报告，包括行数、字数以及字节数。

wc通常是处理来自于通道的输入数据，但是它也可以接收命令行的文件参数，生成一行一个结果，附上报告。

####常用选项

* -c 字节数
* -l 行数
* -w 字数

有一点需要注意：-c原本是显示字符数，但是因为有多字节字符集编码的存在（比如utf8），所以字节数已经不等于字符数了，所以POSIX出现了`-m`选项，用于计算多字节字符。对于8位字符数而言，它是等同于`-c`的。

####使用示例

	echo blog bd17kaka net | wc -l // 读取管道数据
	wc /etc/passwd				   // 读取文件

###将文本文件编页 __pr__

pr命令的作用是将文本文件编页，然后供打印用。

pr读取指定的文件，如果未给予指定文件，则读取标准输入，再将编页完成的数据写到标准输出。

####常用选项

* -cn 产生n栏输出，等同`-n`
* -f 在首页之后的每一页标题前置一个ASCII分页字符
* -h althdr 将页标题内的文件名称，改用`althdr`取代
* -ln 产生`n`行页面
* -on 输出位移`n`非空白
* -t 不显示标题
* -wn 每行至多`n`个字符

####使用示例

	pr -f -l60 -o10 -w65 file(s) | lp
	// 产生60行页面，输出位移10个字符，每行至多65个字符

###提取开头和结尾数行 __head tail__

head和tail分别提取指定文件的开头和结尾数行。

####常用选项

* -n n 开头或者结尾`n`行
* -f 当需要监控某个文件的输出（如日志这类持续写入状态的文件），它可以要求tail显示指定的文件结尾行数，接着进入无止尽的循环中，__休息一秒之后再度醒来并检查是否需显示更多的输出结果__。在设置`-f`的状态下，`tail`只有当你中断它时才会停止，通常输出`Ctrl-C`来中断。

####使用示例

	// 不会自己中断，所以此选项不可用于Shell脚本
	tail -n25 -f /var/log/messages

###strings

###file

###dd

###vgrind

过滤以各种程序语言构成的文件，将它们转换为troff输入。

###tgrind

产生的是TEX输入，可迅速产生PostScript与PDF输出。

###diff

###ASCII和八进制打印工具 __od__

###gsub() 全局性替换

###RS 输入数据的记录分隔器

###ORS 输出数据的记录分隔器